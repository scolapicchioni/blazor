@using PhotoSharingApplication.Shared.Core.Entities

@using PhotoSharingApplication.Shared.Core.Interfaces;

@inject IUserService UserService
@inject IAuthorizationService<Photo> PhotosAuthorizationService

<MatCard>
    <div>
        <MatHeadline6>
            @Photo.Id - @Photo.Title
        </MatHeadline6>
    </div>
    <MatCardContent>
        <MatCardMedia Wide="true" ImageUrl="@Photo.ImageUrl"></MatCardMedia>
        <MatBody2>
            @Photo.Description
        </MatBody2>
        <MatSubtitle2>
            Posted on @Photo.CreatedDate.ToShortDateString() by @Photo.UserName
        </MatSubtitle2>
    </MatCardContent>
    <MatCardActions>
        <MatCardActionButtons>
            @if (Details) {
                <MatButton Link="@($"/photos/details/{Photo.Id}")">Details</MatButton>
            }
            @if (Edit && mayEdit) {
                <MatButton Link="@($"/photos/update/{Photo.Id}")">Update</MatButton>
            }
            @if (Delete && mayDelete) {
                <MatButton Link="@($"/photos/delete/{Photo.Id}")">Delete</MatButton>
            }
            @if (DeleteConfirm) {
                <MatButton OnClick="@(async()=> await OnDeleteConfirmed.InvokeAsync(Photo.Id))">Confirm Deletion</MatButton>
            }
        </MatCardActionButtons>
    </MatCardActions>
</MatCard>

@code {
    [Parameter]
    public Photo Photo { get; set; }

    [Parameter]
    public bool Details { get; set; }
    [Parameter]
    public bool Edit { get; set; }
    [Parameter]
    public bool Delete { get; set; }
    [Parameter]
    public bool DeleteConfirm { get; set; }

    [Parameter]
    public EventCallback<int> OnDeleteConfirmed { get; set; }

    bool mayEdit = false;
    bool mayDelete = false;

    protected override async Task OnInitializedAsync() {
        var User = await UserService.GetUserAsync();
        mayEdit = await PhotosAuthorizationService.ItemMayBeUpdatedAsync(User, Photo);
        mayDelete = await PhotosAuthorizationService.ItemMayBeDeletedAsync(User, Photo);
    }
}
